<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BenchMatch Pro â€” US Staffing AI Tool</title>
<link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;600;700;800&family=Source+Sans+3:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, doc, setDoc, getDocs, deleteDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  // Read config from localStorage (saved via Settings page)
  const firebaseConfig = {
    apiKey: "AIzaSyAOC-e4htzqIe4bDbUnctWmg7O_Eif8S3U",
    authDomain: "benchmatch-pro.firebaseapp.com",
    projectId: "benchmatch-pro",
    storageBucket: "benchmatch-pro.firebasestorage.app",
    messagingSenderId: "829024720701",
    appId: "1:829024720701:web:9897bb062bb4cffd845754",
    measurementId: "G-XDVRMZ7ZQE"
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Global Firebase functions - window pe set karo taaki baaki JS access kar sake
  window._fb = { db, collection, doc, setDoc, getDocs, deleteDoc, onSnapshot, query, orderBy };
  window._firebaseReady = true;
  document.dispatchEvent(new Event('firebaseReady'));

</script>
<style>
:root {
  --bg:#040d1a;--bg2:#071224;--surface:#0a1929;--card:#0d2137;--card2:#102540;
  --border:#1a3a5c;--border2:#1e4570;--blue:#1565c0;--blue2:#1976d2;
  --accent:#00b4d8;--accent2:#0077b6;--gold:#ffd60a;--green:#00e676;
  --red:#ff5252;--orange:#ffab40;--text:#e3eeff;--muted:#5a7a9a;
  --glow:rgba(0,180,216,0.2);--glow2:rgba(21,101,192,0.3);
}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);color:var(--text);font-family:'Source Sans 3',sans-serif;min-height:100vh;overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse at 0% 0%,rgba(21,101,192,.12) 0%,transparent 50%),radial-gradient(ellipse at 100% 100%,rgba(0,180,216,.08) 0%,transparent 50%);pointer-events:none;z-index:0;}

/* LOCK */
#lockScreen{position:fixed;inset:0;background:linear-gradient(135deg,#020812,#040d1a,#071224);display:flex;align-items:center;justify-content:center;z-index:9999;flex-direction:column;}
.lock-box{background:var(--card);border:1px solid var(--border2);border-radius:20px;padding:40px;width:380px;text-align:center;box-shadow:0 0 60px rgba(0,180,216,.1),0 24px 64px rgba(0,0,0,.5);animation:lockIn .6s cubic-bezier(.34,1.56,.64,1) both;}
@keyframes lockIn{from{opacity:0;transform:scale(0.85) translateY(20px)}}
.lock-icon{font-size:44px;margin-bottom:12px;}
.lock-title{font-family:'Raleway',sans-serif;font-size:22px;font-weight:800;margin-bottom:4px;}
.lock-sub{font-size:13px;color:var(--muted);margin-bottom:20px;}
.user-select{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px;}
.user-btn{padding:14px;border:2px solid var(--border);border-radius:12px;background:var(--surface);color:var(--text);font-family:'Raleway',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:all .25s;display:flex;flex-direction:column;align-items:center;gap:6px;}
.user-btn:hover,.user-btn.sel{border-color:var(--accent);background:rgba(0,180,216,.1);color:var(--accent);}
.user-btn .u-avatar{font-size:28px;}
.lock-input{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:12px 16px;color:var(--text);font-family:'Source Sans 3',sans-serif;font-size:15px;outline:none;text-align:center;letter-spacing:3px;transition:border-color .3s;margin-bottom:12px;}
.lock-input:focus{border-color:var(--accent);}
.lock-btn{width:100%;padding:13px;background:linear-gradient(135deg,var(--blue),var(--accent2));border:none;border-radius:10px;color:#fff;font-family:'Raleway',sans-serif;font-size:15px;font-weight:700;cursor:pointer;transition:all .25s;box-shadow:0 4px 20px var(--glow2);}
.lock-btn:hover{transform:translateY(-2px);}
.lock-err{color:var(--red);font-size:13px;margin-top:8px;display:none;}

/* APP */
#app{display:none;}
.topbar{background:rgba(7,18,36,.95);border-bottom:1px solid var(--border);backdrop-filter:blur(12px);padding:0 24px;display:flex;align-items:center;justify-content:space-between;height:60px;position:sticky;top:0;z-index:100;}
.topbar-brand{display:flex;align-items:center;gap:10px;}
.brand-logo{width:36px;height:36px;background:linear-gradient(135deg,var(--blue),var(--accent));border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:16px;box-shadow:0 0 16px var(--glow);}
.brand-name{font-family:'Raleway',sans-serif;font-size:18px;font-weight:800;}
.brand-tag{font-size:10px;color:var(--accent);font-weight:600;letter-spacing:.5px;}
.topbar-nav{display:flex;gap:3px;}
.nav-btn{padding:7px 13px;border:none;border-radius:8px;font-family:'Source Sans 3',sans-serif;font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;background:transparent;color:var(--muted);display:flex;align-items:center;gap:5px;}
.nav-btn:hover{background:rgba(255,255,255,.05);color:var(--text);}
.nav-btn.on{background:rgba(0,180,216,.12);color:var(--accent);}
.topbar-right{display:flex;align-items:center;gap:10px;}
.user-chip{background:rgba(0,180,216,.1);border:1px solid rgba(0,180,216,.25);border-radius:20px;padding:5px 12px;font-size:12px;color:var(--accent);font-weight:700;display:flex;align-items:center;gap:6px;}
.status-dot{width:7px;height:7px;background:var(--green);border-radius:50%;box-shadow:0 0 8px var(--green);animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
.logout-btn{padding:5px 12px;border:1px solid var(--border);border-radius:8px;font-size:12px;color:var(--muted);background:none;cursor:pointer;transition:all .2s;}
.logout-btn:hover{border-color:var(--red);color:var(--red);}

/* PANELS */
.panel{display:none;}.panel.on{display:block;}
.wrap{max-width:1060px;margin:0 auto;padding:24px 20px;position:relative;z-index:1;}
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:22px;margin-bottom:18px;transition:border-color .3s;animation:fadeUp .5s ease both;}
.card:hover{border-color:var(--border2);}
.card-header{display:flex;align-items:center;gap:10px;margin-bottom:6px;}
.card-title{font-family:'Raleway',sans-serif;font-size:16px;font-weight:700;}
.card-sub{color:var(--muted);font-size:13px;margin-bottom:18px;line-height:1.5;}
.stats-row{display:grid;grid-template-columns:repeat(5,1fr);gap:14px;margin-bottom:22px;}
@media(max-width:700px){.stats-row{grid-template-columns:repeat(2,1fr)}}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;text-align:center;transition:all .3s;animation:fadeUp .5s ease both;}
.stat-card:hover{border-color:var(--border2);transform:translateY(-2px);}
.stat-num{font-family:'Raleway',sans-serif;font-size:26px;font-weight:800;line-height:1;}
.stat-label{font-size:11px;color:var(--muted);margin-top:4px;}

/* DROPZONE */
.dropzone{border:2px dashed var(--border);border-radius:14px;padding:36px 20px;text-align:center;cursor:pointer;transition:all .3s;position:relative;}
.dropzone:hover,.dropzone.over{border-color:var(--accent);background:rgba(0,180,216,.04);}
.dropzone input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;}
.dz-icon{font-size:38px;margin-bottom:10px;}.dz-text{font-size:15px;font-weight:600;}.dz-hint{font-size:12px;color:var(--muted);margin-top:5px;}

/* CANDIDATES */
.cand-list{display:flex;flex-direction:column;gap:8px;margin-top:14px;}
.cand-item{display:flex;align-items:center;gap:12px;background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:12px 16px;transition:all .25s;animation:fadeUp .4s ease both;}
.cand-item:hover{border-color:var(--border2);transform:translateX(3px);}
.cand-avatar{width:38px;height:38px;border-radius:9px;background:linear-gradient(135deg,rgba(21,101,192,.3),rgba(0,180,216,.3));display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0;}
.cand-info{flex:1;min-width:0;}
.cand-name{font-size:14px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.cand-meta{font-size:12px;color:var(--muted);margin-top:2px;}
.cand-skills{display:flex;flex-wrap:wrap;gap:4px;margin-top:5px;}
.skill-tag{padding:2px 8px;border-radius:6px;font-size:11px;font-weight:600;background:rgba(0,180,216,.1);color:var(--accent);border:1px solid rgba(0,180,216,.2);}
.cand-check{width:22px;height:22px;border:2px solid var(--border);border-radius:6px;cursor:pointer;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;transition:all .2s;}
.cand-check.on{background:var(--accent);border-color:var(--accent);color:#000;}
.cand-del{background:none;border:none;color:var(--muted);cursor:pointer;font-size:15px;padding:4px;border-radius:6px;transition:all .2s;}
.cand-del:hover{color:var(--red);background:rgba(255,82,82,.1);}

/* TEXTAREA */
textarea{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:14px;color:var(--text);font-family:'Source Sans 3',sans-serif;font-size:14px;line-height:1.7;resize:vertical;min-height:160px;outline:none;transition:border-color .3s;}
textarea:focus{border-color:var(--accent);}
textarea::placeholder{color:var(--muted);}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;gap:8px;padding:11px 22px;border-radius:10px;border:none;font-family:'Raleway',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:all .25s;}
.btn-primary{background:linear-gradient(135deg,var(--blue),var(--blue2));color:#fff;box-shadow:0 4px 20px var(--glow2);width:100%;justify-content:center;margin-top:14px;}
.btn-primary:hover{transform:translateY(-2px);}
.btn-primary:disabled{opacity:.5;cursor:not-allowed;transform:none;}
.btn-accent{background:linear-gradient(135deg,var(--accent2),var(--accent));color:#fff;box-shadow:0 4px 16px var(--glow);padding:8px 16px;font-size:13px;}
.btn-accent:hover{transform:translateY(-2px);}
.btn-green{background:linear-gradient(135deg,#00875a,#00e676);color:#000;padding:8px 16px;font-size:13px;font-weight:800;}
.btn-green:hover{transform:translateY(-2px);}
.btn-ghost{background:rgba(255,255,255,.05);color:var(--muted);border:1px solid var(--border);padding:7px 14px;font-size:12px;}
.btn-ghost:hover{border-color:var(--border2);color:var(--text);}

/* TRACKER */
.tracker-form{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;}
@media(max-width:600px){.tracker-form{grid-template-columns:1fr}}
.tf-input{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:11px 14px;color:var(--text);font-family:'Source Sans 3',sans-serif;font-size:13px;outline:none;transition:border-color .3s;width:100%;}
.tf-input:focus{border-color:var(--accent);}
.tf-input::placeholder{color:var(--muted);}
.tf-label{font-size:12px;color:var(--muted);font-weight:600;margin-bottom:5px;}
.tf-group{display:flex;flex-direction:column;}
.tf-select{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:11px 14px;color:var(--text);font-family:'Source Sans 3',sans-serif;font-size:13px;outline:none;cursor:pointer;width:100%;}
.tf-select:focus{border-color:var(--accent);}

/* SUBMISSIONS TABLE */
.sub-table{width:100%;border-collapse:collapse;font-size:13px;}
.sub-table th{background:var(--surface);color:var(--muted);font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;padding:10px 12px;text-align:left;border-bottom:1px solid var(--border);}
.sub-table td{padding:10px 12px;border-bottom:1px solid rgba(26,58,92,.5);vertical-align:middle;}
.sub-table tr:hover td{background:rgba(0,180,216,.03);}
.status-badge{padding:3px 10px;border-radius:99px;font-size:11px;font-weight:700;display:inline-block;}
.s-submitted{background:rgba(0,180,216,.15);color:var(--accent);}
.s-interview{background:rgba(255,171,64,.15);color:var(--orange);}
.s-placed{background:rgba(0,230,118,.15);color:var(--green);}
.s-rejected{background:rgba(255,82,82,.15);color:var(--red);}
.s-interviewing{background:rgba(255,214,10,.15);color:var(--gold);}
.del-row-btn{background:none;border:none;color:var(--muted);cursor:pointer;font-size:14px;padding:3px 6px;border-radius:6px;transition:all .2s;}
.del-row-btn:hover{color:var(--red);background:rgba(255,82,82,.1);}
.table-wrap{overflow-x:auto;}
.empty-table{text-align:center;padding:40px;color:var(--muted);}
.empty-table .ei{font-size:38px;margin-bottom:10px;opacity:.4;}

/* RESULTS */
.result-summary{background:linear-gradient(135deg,var(--card),var(--card2));border:1px solid var(--border2);border-radius:16px;padding:18px 22px;margin-bottom:18px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:14px;}
.rs-title{font-family:'Raleway',sans-serif;font-size:16px;font-weight:700;}
.rs-stats{display:flex;gap:18px;flex-wrap:wrap;}
.rs-stat{text-align:center;}
.rs-num{font-family:'Raleway',sans-serif;font-size:20px;font-weight:800;line-height:1;}
.rs-label{font-size:11px;color:var(--muted);margin-top:2px;}
.result-list{display:flex;flex-direction:column;gap:10px;}
.result-item{background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;transition:all .25s;animation:fadeUp .5s ease both;}
.result-item:hover{border-color:var(--border2);}
.result-header{display:flex;align-items:center;gap:12px;padding:14px 18px;cursor:pointer;flex-wrap:wrap;}
.score-pill{width:54px;height:54px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-family:'Raleway',sans-serif;font-size:15px;font-weight:800;flex-shrink:0;}
.sp-hot{background:rgba(0,230,118,.12);color:var(--green);border:1px solid rgba(0,230,118,.25);}
.sp-good{background:rgba(0,180,216,.12);color:var(--accent);border:1px solid rgba(0,180,216,.25);}
.sp-avg{background:rgba(255,171,64,.12);color:var(--orange);border:1px solid rgba(255,171,64,.25);}
.sp-low{background:rgba(255,82,82,.12);color:var(--red);border:1px solid rgba(255,82,82,.25);}
.result-info{flex:1;min-width:160px;}
.result-name{font-size:15px;font-weight:600;margin-bottom:3px;}
.result-verdict{font-size:12px;color:var(--muted);}
.result-bar-wrap{flex:1;min-width:100px;}
.result-bar-bg{height:6px;background:var(--border);border-radius:99px;overflow:hidden;margin-bottom:4px;}
.result-bar-fill{height:100%;border-radius:99px;transition:width 1.2s cubic-bezier(.4,0,.2,1);}
.result-verdict-label{font-size:11px;color:var(--muted);text-align:right;}
.shortlist-star{color:var(--gold);font-size:15px;}
.result-body{display:none;padding:0 18px 18px;border-top:1px solid var(--border);padding-top:18px;}
.kw-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:14px;}
@media(max-width:600px){.kw-grid{grid-template-columns:1fr}}
.kw-box{background:var(--surface);border:1px solid var(--border);border-radius:11px;padding:12px;}
.kw-title{font-size:11px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px;}
.kw-tags{display:flex;flex-wrap:wrap;gap:5px;}
.kw-match{background:rgba(0,230,118,.1);color:var(--green);border:1px solid rgba(0,230,118,.2);padding:3px 9px;border-radius:6px;font-size:12px;font-weight:500;}
.kw-miss{background:rgba(255,82,82,.1);color:var(--red);border:1px solid rgba(255,82,82,.2);padding:3px 9px;border-radius:6px;font-size:12px;font-weight:500;}
.ai-note{background:linear-gradient(135deg,rgba(21,101,192,.1),rgba(0,180,216,.05));border:1px solid var(--border2);border-radius:12px;padding:16px;margin-bottom:14px;}
.ai-note-header{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.ai-face{width:36px;height:36px;border-radius:9px;background:linear-gradient(135deg,var(--blue),var(--accent));display:flex;align-items:center;justify-content:center;font-size:15px;box-shadow:0 0 12px var(--glow);}
.ai-note-name{font-size:14px;font-weight:600;}
.ai-note-role{font-size:11px;color:var(--muted);}
.ai-note-text{font-size:13px;line-height:1.75;color:var(--text);font-style:italic;border-left:3px solid var(--accent);padding-left:12px;}
.tips-list{display:flex;flex-direction:column;gap:8px;margin-bottom:14px;}
.tip-item{display:flex;gap:10px;background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:11px;}
.tip-num{width:22px;height:22px;background:var(--blue);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0;color:#fff;}
.tip-text{font-size:13px;line-height:1.6;}
.tip-text strong{color:var(--text);font-weight:600;display:block;margin-bottom:2px;}
.tip-text span{color:var(--muted);}
.email-box{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:8px;}
.email-box-title{font-size:12px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:10px;display:flex;align-items:center;justify-content:space-between;}
.email-content{font-size:13px;line-height:1.75;color:var(--text);white-space:pre-wrap;}
.copy-btn{background:rgba(0,180,216,.1);border:1px solid rgba(0,180,216,.25);color:var(--accent);border-radius:6px;padding:4px 11px;font-size:11px;font-weight:600;cursor:pointer;transition:all .2s;}
.copy-btn:hover{background:rgba(0,180,216,.2);}

/* JOB PORTALS */
.portals-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px;}
.portal-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:14px;text-align:center;text-decoration:none;color:var(--text);transition:all .25s;display:flex;flex-direction:column;align-items:center;gap:6px;}
.portal-card:hover{border-color:var(--accent);transform:translateY(-3px);box-shadow:0 8px 24px rgba(0,180,216,.1);}
.portal-icon{font-size:26px;}
.portal-name{font-size:13px;font-weight:700;}
.portal-type{font-size:10px;color:var(--green);font-weight:600;background:rgba(0,230,118,.1);padding:2px 8px;border-radius:99px;}

/* MISC */
.qlinks{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;}
.qlink{display:inline-flex;align-items:center;gap:6px;padding:7px 13px;border-radius:8px;font-size:12px;font-weight:600;text-decoration:none;transition:all .2s;border:1px solid var(--border);background:var(--surface);color:var(--text);}
.qlink:hover{border-color:var(--accent);color:var(--accent);transform:translateY(-1px);}
.loader-wrap{text-align:center;padding:48px 20px;}
.loader{display:inline-block;width:44px;height:44px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite;margin-bottom:14px;}
@keyframes spin{to{transform:rotate(360deg)}}
.loader-text{color:var(--muted);font-size:14px;}
.empty{text-align:center;padding:36px;color:var(--muted);}
.empty-icon{font-size:40px;margin-bottom:10px;opacity:.4;}
.row{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;margin-bottom:10px;}
.badge{padding:3px 10px;border-radius:99px;font-size:11px;font-weight:700;}
.badge-blue{background:rgba(0,180,216,.15);color:var(--accent);}
.sel-all-btn{background:none;border:1px solid var(--border);color:var(--muted);border-radius:7px;padding:5px 12px;font-size:12px;cursor:pointer;transition:all .2s;}
.sel-all-btn:hover{border-color:var(--accent);color:var(--accent);}
.status-bar{font-size:13px;padding:10px 14px;border-radius:10px;background:var(--surface);margin-top:10px;}
.parse-tabs{display:flex;gap:6px;margin-bottom:14px;}
.ptab{flex:1;padding:8px;border:1px solid var(--border);border-radius:9px;background:transparent;color:var(--muted);font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;font-family:'Source Sans 3',sans-serif;}
.ptab.on{background:rgba(0,180,216,.12);border-color:var(--accent);color:var(--accent);}
.toast{position:fixed;bottom:22px;right:22px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px 16px;font-size:13px;z-index:9999;animation:toastIn .3s ease;box-shadow:0 8px 32px rgba(0,0,0,.5);}
@keyframes toastIn{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeDown{from{opacity:0;transform:translateY(-14px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
.divider{height:1px;background:var(--border);margin:18px 0;}
.section-title{font-family:'Raleway',sans-serif;font-size:14px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:12px;}

/* DASHBOARD SUBMISSIONS */
.recent-sub-list{display:flex;flex-direction:column;gap:8px;}
.recent-sub-item{display:flex;align-items:center;gap:12px;background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:11px 14px;transition:all .25s;}
.recent-sub-item:hover{border-color:var(--border2);}
.rsub-info{flex:1;}
.rsub-name{font-size:14px;font-weight:600;}
.rsub-meta{font-size:12px;color:var(--muted);margin-top:2px;}
</style>
</head>
<body>

<!-- LOCK SCREEN -->
<div id="lockScreen">
  <div class="lock-box">
    <div class="lock-icon">ğŸš€</div>
    <div class="lock-title">BenchMatch Pro</div>
    <div class="lock-sub">US Staffing AI Tool â€” Select your account</div>
    <div class="user-select">
      <button class="user-btn sel" id="ubtn-brijesh" onclick="selectUser('brijesh')">
        <span class="u-avatar">ğŸ‘¤</span>
        <span>Brijesh</span>
      </button>
      <button class="user-btn" id="ubtn-shailesh" onclick="selectUser('shailesh')">
        <span class="u-avatar">ğŸ‘¤</span>
        <span>Shailesh</span>
      </button>
    </div>
    <input type="password" class="lock-input" id="pwInput" placeholder="Enter your password" onkeydown="if(event.key==='Enter')checkPw()">
    <button class="lock-btn" onclick="checkPw()">ğŸ”“ Login</button>
    <div class="lock-err" id="pwErr">âŒ Wrong password. Try again.</div>
    <div style="font-size:11px;color:var(--muted);margin-top:12px;">Default passwords: brijesh â†’ <b>bench2024</b> &nbsp;|&nbsp; shailesh â†’ <b>bench2024</b></div>
  </div>
</div>

<!-- MAIN APP -->
<div id="app">
  <div class="topbar">
    <div class="topbar-brand">
      <div class="brand-logo">âš¡</div>
      <div>
        <div class="brand-name">BenchMatch Pro</div>
        <div class="brand-tag">US STAFFING AI TOOL</div>
      </div>
    </div>
    <div class="topbar-nav">
      <button class="nav-btn on" onclick="switchTab('dashboard')" id="nav-dashboard">ğŸ“Š Dashboard</button>
      <button class="nav-btn" onclick="switchTab('candidates')" id="nav-candidates">ğŸ‘¥ Candidates</button>
      <button class="nav-btn" onclick="switchTab('match')" id="nav-match">ğŸ¯ Match JD</button>
      <button class="nav-btn" onclick="switchTab('tracker')" id="nav-tracker">ğŸ“‹ Tracker</button>
      <button class="nav-btn" onclick="switchTab('portals')" id="nav-portals">ğŸŒ Job Portals</button>
      <button class="nav-btn" onclick="switchTab('settings')" id="nav-settings">âš™ï¸ Settings</button>
    </div>
    <div class="topbar-right">
      <div class="status-dot"></div>
      <div id="fb-sync-chip" style="background:rgba(255,171,64,.1);border:1px solid rgba(255,171,64,.25);border-radius:20px;padding:5px 10px;font-size:11px;color:#ffab40;font-weight:700;display:none;align-items:center;gap:5px;">â˜ï¸ Syncing...</div>
      <div class="user-chip" id="user-chip">ğŸ‘¤ Brijesh</div>
      <button class="logout-btn" onclick="logout()">ğŸ”’ Logout</button>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div id="panel-dashboard" class="panel on">
    <div class="wrap">
      <div style="margin-bottom:20px;animation:fadeDown .5s ease both">
        <div style="font-family:'Raleway',sans-serif;font-size:22px;font-weight:800;margin-bottom:4px">Good day! ğŸ‘‹ <span id="dash-username"></span></div>
        <div style="color:var(--muted);font-size:13px">Your bench sales command center â€” all requirements, all candidates, one place.</div>
      </div>
      <div class="stats-row">
        <div class="stat-card" style="animation-delay:.05s"><div class="stat-num" style="color:var(--accent)" id="stat-candidates">0</div><div class="stat-label">Bench Candidates</div></div>
        <div class="stat-card" style="animation-delay:.1s"><div class="stat-num" style="color:var(--green)" id="stat-submissions">0</div><div class="stat-label">Total Submissions</div></div>
        <div class="stat-card" style="animation-delay:.15s"><div class="stat-num" style="color:var(--gold)" id="stat-interviews">0</div><div class="stat-label">Interviews</div></div>
        <div class="stat-card" style="animation-delay:.2s"><div class="stat-num" style="color:var(--orange)" id="stat-placed">0</div><div class="stat-label">Placed</div></div>
        <div class="stat-card" style="animation-delay:.25s"><div class="stat-num" style="color:var(--blue2)" id="stat-matches">0</div><div class="stat-label">AI Matches Run</div></div>
      </div>

      <div class="card" style="animation-delay:.3s">
        <div class="card-header"><span style="font-size:20px">ğŸ“‹</span><div class="card-title">Recent Submissions</div></div>
        <div id="dash-recent-subs">
          <div class="empty"><div class="empty-icon">ğŸ“­</div><div>No submissions yet â€” use Tracker tab to add!</div></div>
        </div>
      </div>

      <div class="card" style="animation-delay:.35s">
        <div class="card-header"><span style="font-size:20px">âš¡</span><div class="card-title">Quick Workflow</div></div>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:4px">
          <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:14px;text-align:center"><div style="font-size:26px;margin-bottom:8px">1ï¸âƒ£</div><div style="font-weight:600;font-size:13px;margin-bottom:4px">Upload Candidates</div><div style="font-size:12px;color:var(--muted)">Candidates tab â†’ Upload PDF resumes</div></div>
          <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:14px;text-align:center"><div style="font-size:26px;margin-bottom:8px">2ï¸âƒ£</div><div style="font-weight:600;font-size:13px;margin-bottom:4px">Paste Requirement</div><div style="font-size:12px;color:var(--muted)">Match JD tab â†’ Paste JD from Gmail</div></div>
          <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:14px;text-align:center"><div style="font-size:26px;margin-bottom:8px">3ï¸âƒ£</div><div style="font-weight:600;font-size:13px;margin-bottom:4px">AI Analyzes</div><div style="font-size:12px;color:var(--muted)">Click Analyze â†’ AI ranks candidates</div></div>
          <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:14px;text-align:center"><div style="font-size:26px;margin-bottom:8px">4ï¸âƒ£</div><div style="font-weight:600;font-size:13px;margin-bottom:4px">Track & Submit</div><div style="font-size:12px;color:var(--muted)">Tracker tab â†’ Log submissions</div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- CANDIDATES -->
  <div id="panel-candidates" class="panel">
    <div class="wrap">
      <div class="card">
        <div class="card-header"><span style="font-size:20px">ğŸ“¤</span><div class="card-title">Upload Bench Candidates</div></div>
        <div class="card-sub">Upload PDF/DOC resumes â€” they stay saved in your account. AI will read them automatically.</div>
        <div class="dropzone" id="dropzone">
          <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.txt" multiple>
          <div class="dz-icon">ğŸ“„</div>
          <div class="dz-text">Click to upload or drag & drop resumes</div>
          <div class="dz-hint">âœ… PDF &nbsp;âœ… DOC &nbsp;âœ… DOCX &nbsp;âœ… TXT â€” Multiple files OK</div>
        </div>
      </div>
      <div class="card">
        <div class="row">
          <div class="card-header" style="margin-bottom:0"><span style="font-size:20px">ğŸ‘¥</span><div class="card-title">Bench Candidates <span class="badge badge-blue" id="cand-count">0</span></div></div>
          <div style="display:flex;gap:8px">
            <button class="sel-all-btn" onclick="selectAllCands()">Select All</button>
            <button class="sel-all-btn" style="color:var(--red);border-color:rgba(255,82,82,.3)" onclick="clearAll()">ğŸ—‘ï¸ Clear All</button>
          </div>
        </div>
        <div class="card-sub">Select candidates for JD matching.</div>
        <div class="cand-list" id="cand-list"><div class="empty"><div class="empty-icon">ğŸ‘¤</div><div>No candidates yet. Upload resumes above!</div></div></div>
      </div>
    </div>
  </div>

  <!-- MATCH JD -->
  <div id="panel-match" class="panel">
    <div class="wrap">
      <div class="card">
        <div class="card-header"><span style="font-size:20px">ğŸ“‹</span><div class="card-title">Paste Job Requirement</div></div>
        <div class="card-sub">Copy the requirement from Gmail or any job board and paste it below. AI will match against your bench candidates.</div>
        <div class="parse-tabs">
          <button class="ptab on" onclick="setPTab(0)">ğŸ“§ From Gmail / Email</button>
          <button class="ptab" onclick="setPTab(1)">ğŸŒ From Job Board</button>
        </div>
        <textarea id="jdInput" placeholder="Paste the full requirement here...&#10;&#10;Example:&#10;Hi, urgent requirement for Java Developer&#10;Location: Austin TX (Hybrid)&#10;Duration: 12 Months C2C&#10;Rate: $65/hr&#10;Skills: Java, Spring Boot, AWS, Docker&#10;Visa: Any â€” Please send matching profiles ASAP"></textarea>
        <div class="status-bar" id="sel-status" style="color:#ffc107">âš ï¸ No candidates selected â€” go to Candidates tab first</div>
        <button class="btn btn-primary" id="analyzeBtn" onclick="runMatch()">ğŸ¤– Match with AI Hiring Manager</button>
      </div>
      <div id="results-area"></div>
    </div>
  </div>

  <!-- TRACKER -->
  <div id="panel-tracker" class="panel">
    <div class="wrap">
      <div class="card">
        <div class="card-header"><span style="font-size:20px">â•</span><div class="card-title">Add New Submission</div></div>
        <div class="card-sub">Fill in the details and click Submit to track this candidate.</div>
        <div class="tracker-form">
          <div class="tf-group"><div class="tf-label">ğŸ‘¤ Candidate Name *</div><input class="tf-input" id="t-cname" placeholder="e.g. Rahul Sharma"></div>
          <div class="tf-group"><div class="tf-label">ğŸ’» Skills / Technology *</div><input class="tf-input" id="t-skills" placeholder="e.g. Java, Spring Boot, AWS"></div>
          <div class="tf-group"><div class="tf-label">ğŸ¢ Vendor / Client Name</div><input class="tf-input" id="t-vendor" placeholder="e.g. TechCorp Inc"></div>
          <div class="tf-group"><div class="tf-label">ğŸ“§ Vendor Email</div><input class="tf-input" id="t-email" type="email" placeholder="vendor@company.com"></div>
          <div class="tf-group"><div class="tf-label">ğŸ“ Vendor Phone</div><input class="tf-input" id="t-phone" placeholder="e.g. +1-555-123-4567"></div>
          <div class="tf-group"><div class="tf-label">ğŸ’° Rate (C2C)</div><input class="tf-input" id="t-rate" placeholder="e.g. $75/hr C2C"></div>
          <div class="tf-group"><div class="tf-label">ğŸ“ Location / State</div><input class="tf-input" id="t-location" placeholder="e.g. Austin, TX (Remote)"></div>
          <div class="tf-group"><div class="tf-label">ğŸ“Š Status</div>
            <select class="tf-select" id="t-status">
              <option value="Submitted">ğŸ”µ Submitted</option>
              <option value="Interview Scheduled">ğŸŸ¡ Interview Scheduled</option>
              <option value="Interview Done">ğŸŸ  Interview Done</option>
              <option value="Placed">ğŸŸ¢ Placed</option>
              <option value="Rejected">ğŸ”´ Rejected</option>
            </select>
          </div>
          <div class="tf-group" style="grid-column:1/-1"><div class="tf-label">ğŸ“ Notes / Comments</div><input class="tf-input" id="t-notes" placeholder="Any additional notes about this submission..."></div>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn btn-accent" onclick="addSubmission()">âœ… Add Submission</button>
          <button class="btn btn-green" onclick="exportExcel()">ğŸ“¥ Download Excel</button>
        </div>
      </div>

      <div class="card">
        <div class="row">
          <div class="card-header" style="margin-bottom:0"><span style="font-size:20px">ğŸ“‹</span><div class="card-title">All Submissions <span class="badge badge-blue" id="sub-count">0</span></div></div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <select class="tf-select" id="filter-status" style="width:auto;padding:6px 12px;font-size:12px" onchange="renderSubmissions()">
              <option value="">All Status</option>
              <option value="Submitted">Submitted</option>
              <option value="Interview Scheduled">Interview Scheduled</option>
              <option value="Interview Done">Interview Done</option>
              <option value="Placed">Placed</option>
              <option value="Rejected">Rejected</option>
            </select>
            <button class="btn btn-green" style="padding:6px 14px;font-size:12px" onclick="exportExcel()">ğŸ“¥ Excel</button>
          </div>
        </div>
        <div class="table-wrap" style="margin-top:14px">
          <div id="sub-table-wrap"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- JOB PORTALS -->
  <div id="panel-portals" class="panel">
    <div class="wrap">
      <div class="card">
        <div class="card-header"><span style="font-size:20px">ğŸŒ</span><div class="card-title">C2C Job Portals â€” US Staffing</div></div>
        <div class="card-sub">All portals below support <strong style="color:var(--green)">Corp-to-Corp (C2C)</strong> contracts. Click any to open directly.</div>
        <div class="section-title">ğŸ”¥ Top C2C Platforms</div>
        <div class="portals-grid">
          <a href="https://www.dice.com/jobs?filters.employerType=Third+Party" target="_blank" class="portal-card">
            <span class="portal-icon">ğŸ²</span><span class="portal-name">Dice</span><span class="portal-type">C2C âœ…</span>
          </a>
          <a href="https://www.techfetch.com/job/searchjobs.aspx" target="_blank" class="portal-card">
            <span class="portal-icon">ğŸ’»</span><span class="portal-name">TechFetch</span><span class="portal-type">C2C âœ…</span>
          </a>
          <a href="https://www.corp2corp.jobs/" target="_blank" class="portal-card">
            <span class="portal-icon">ğŸ¤</span><span class="portal-name">Corp2Corp.jobs</span><span class="portal-type">C2C Only âœ…</span>
          </a>
          <a href="https://www.itjobcafe.com/" target="_blank" class="portal-card">
            <span class="portal-icon">â˜•</span><span class="portal-name">ITJobCafe</span><span class="portal-type">C2C âœ…</span>
          </a>
          <a href="https://www.jobsforh1b.com/" target="_blank" class="portal-card">
            <span class="portal-icon">ğŸ›‚</span><span class="portal-name">JobsForH1B</span><span class="portal-type">C2C âœ…</span>
          </a>
          <a href="https://www.hiremefirst.com/" target="_blank" class="portal-card">
            <span class="portal-icon">â­</span><span class="portal-name">HireMeFirst</span><span class="portal-type">C2C âœ…</span>
          </a>
          <a href="https://www.careerbuilder.com/jobs?keywords=&location=&posted=&pay=&employment_type=PartTime%2CFullTime%2CContractor&edu=&radius=30&city_state=" target="_blank" class="portal-card">
            <span class="portal-icon">ğŸ—ï¸</span><span class="portal-name">CareerBuilder</span><span class="portal-type">C2C âœ…</span>
          </a>
          <a href="https://www.monster.com/jobs/search" target="_blank" class="portal-card">
            <span class="portal-icon">ğŸ‘¾</span><span class="portal-name">Monster</span><span class="portal-type">C2C âœ…</span>
          </a>
          <a href="https://www.indeed.com/jobs?q=contract+c2c" target="_blank" class="portal-card">
            <span class="portal-icon">ğŸ”</span><span class="portal-name">Indeed</span><span class="portal-type">C2C Filter</span>
          </a>
          <a href="https://www.ziprecruiter.com/jobs-search?search=contract+c2c" target="_blank" class="portal-card">
            <span class="portal-icon">ğŸ“¦</span><span class="portal-name">ZipRecruiter</span><span class="portal-type">C2C âœ…</span>
          </a>
          <a href="https://www.benchfolks.com/" target="_blank" class="portal-card">
            <span class="portal-icon">ğŸª‘</span><span class="portal-name">BenchFolks</span><span class="portal-type">Bench C2C âœ…</span>
          </a>
          <a href="https://www.hirequest.com/" target="_blank" class="portal-card">
            <span class="portal-icon">ğŸ¯</span><span class="portal-name">HireQuest</span><span class="portal-type">C2C âœ…</span>
          </a>
        </div>

        <div class="divider"></div>
        <div class="section-title">ğŸ” Search with Keyword</div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:14px">
          <input class="tf-input" id="portal-kw" placeholder="e.g. Java Developer, React, AWS..." style="flex:1;min-width:200px">
          <button class="btn btn-accent" onclick="searchAllPortals()">ğŸ” Search All Portals</button>
        </div>
        <div id="portal-links" style="display:none">
          <div class="section-title">Quick Links with Your Keyword:</div>
          <div class="qlinks" id="portal-qlinks"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- SETTINGS -->
  <div id="panel-settings" class="panel">
    <div class="wrap">
      <div class="card">
        <div class="card-header"><span style="font-size:20px">ğŸ”‘</span><div class="card-title">Gemini API Key (Shared)</div></div>
        <div class="card-sub">Ek shared API Key dono users use karenge â€” zyada requests milenge. Key sirf is browser mein save hogi.</div>
        <div style="display:flex;flex-direction:column;gap:10px;max-width:500px">
          <div style="position:relative">
            <input type="password" id="apiKeyInput" placeholder="AIzaSy..." style="background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:12px 16px;color:var(--text);font-size:14px;outline:none;font-family:'Source Sans 3',sans-serif;width:100%;padding-right:80px">
            <button onclick="toggleApiVis()" style="position:absolute;right:10px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--muted);cursor:pointer;font-size:12px" id="apiVisBtn">Show</button>
          </div>
          <div style="display:flex;gap:10px">
            <button class="btn btn-accent" onclick="saveApiKey()" style="width:fit-content">ğŸ’¾ Save API Key</button>
            <button class="btn btn-ghost" onclick="testApiKey()" style="width:fit-content">ğŸ§ª Test Key</button>
          </div>
          <div id="apiKeyStatus" style="font-size:13px;color:var(--muted)"></div>
        </div>
        <div style="margin-top:14px;background:rgba(0,180,216,.06);border:1px solid rgba(0,180,216,.15);border-radius:10px;padding:12px;font-size:13px;color:var(--muted);line-height:1.7">
          âš ï¸ <strong style="color:var(--text)">Important:</strong> API Key kisi ke saath share mat karo!<br>
          ğŸ”‘ Key leni hai? <a href="https://aistudio.google.com/api-keys" target="_blank" style="color:var(--accent)">aistudio.google.com/api-keys</a> pe jaao
        </div>
      </div>

      <div class="card">
        <div class="card-header"><span style="font-size:20px">ğŸ”</span><div class="card-title">Change Password</div></div>
        <div class="card-sub">Apna password change karo. Dono users ke alag alag password hain.</div>
        <div style="display:flex;flex-direction:column;gap:10px;max-width:360px">
          <div style="font-size:13px;color:var(--muted);background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:10px 14px;">Changing password for: <strong style="color:var(--accent)" id="pw-for-user">Brijesh</strong></div>
          <input type="password" id="newPw1" placeholder="New password" style="background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:12px 16px;color:var(--text);font-size:14px;outline:none;font-family:'Source Sans 3',sans-serif">
          <input type="password" id="newPw2" placeholder="Confirm new password" style="background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:12px 16px;color:var(--text);font-size:14px;outline:none;font-family:'Source Sans 3',sans-serif">
          <button class="btn btn-accent" onclick="changePw()" style="width:fit-content">ğŸ’¾ Save Password</button>
        </div>
      </div>

      <div class="card">
        <div class="card-header"><span style="font-size:20px">ğŸ”¥</span><div class="card-title">Firebase Setup</div></div>
        <div class="card-sub">Apna Firebase config daalo â€” dono users ka Tracker data real-time sync hoga! ğŸ”„</div>
        <div style="background:rgba(255,171,64,.08);border:1px solid rgba(255,171,64,.2);border-radius:10px;padding:14px;margin-bottom:14px;font-size:13px;line-height:1.9">
          <b style="color:var(--gold)">Setup Steps:</b><br>
          1ï¸âƒ£ <a href="https://console.firebase.google.com" target="_blank" style="color:var(--accent)">Firebase Console</a> â†’ benchmatch-pro project â†’ Project Settings (âš™ï¸)<br>
          2ï¸âƒ£ <b>Your apps</b> â†’ Web app â†’ <b>SDK setup and configuration</b><br>
          3ï¸âƒ£ Wahan se <b>firebaseConfig</b> object copy karo<br>
          4ï¸âƒ£ Neeche paste karo aur Save karo
        </div>
        <textarea id="fb-config-input" style="background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:12px;color:var(--text);font-size:12px;width:100%;min-height:160px;font-family:monospace;outline:none" placeholder='Yahan paste karo:
{
  apiKey: "AIzaSy...",
  authDomain: "benchmatch-pro.firebaseapp.com",
  projectId: "benchmatch-pro",
  ...
}'></textarea>
        <div style="display:flex;gap:10px;margin-top:10px">
          <button class="btn btn-accent" onclick="saveFbConfig()" style="width:fit-content">ğŸ’¾ Save Firebase Config</button>
          <button class="btn btn-ghost" onclick="testFbConfig()" style="width:fit-content">ğŸ§ª Test Connection</button>
        </div>
        <div id="fb-config-status" style="font-size:13px;color:var(--muted);margin-top:8px"></div>
        <div style="margin-top:10px;font-size:12px;color:var(--muted)">â„¹ï¸ Config browser mein save hoti hai. Dono users ke computers pe alag alag save karni hogi.</div>
      </div>

      <div class="card">
        <div class="card-header"><span style="font-size:20px">â„¹ï¸</span><div class="card-title">About</div></div>
        <div style="font-size:13px;color:var(--muted);line-height:1.9">
          <b style="color:var(--text)">BenchMatch Pro v3.0</b> â€” Built for US Staffing Bench Sales Recruiters<br>
          âœ… 2 User Accounts â€” Brijesh & Shailesh (separate data)<br>
          âœ… Candidate Tracker with Excel Export<br>
          âœ… 12 C2C Job Portals<br>
          âœ… AI powered by Google Gemini (Free tier)<br>
          âœ… 100% runs in your browser â€” no server, no subscription<br>
          âœ… Data saved locally â€” browser band hone ke baad bhi rahega
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  USER SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const USERS = {
  brijesh: { displayName: 'Brijesh', emoji: 'ğŸ‘¤', pwKey: 'bmp_pw_brijesh', defaultPw: 'bench2024' },
  shailesh: { displayName: 'Shailesh', emoji: 'ğŸ‘¤', pwKey: 'bmp_pw_shailesh', defaultPw: 'bench2024' }
};
let currentUser = 'brijesh';

function userKey(k) { return `bmp_${currentUser}_${k}`; }

function selectUser(u) {
  currentUser = u;
  document.querySelectorAll('.user-btn').forEach(b => b.classList.remove('sel'));
  document.getElementById('ubtn-'+u).classList.add('sel');
  document.getElementById('pwInput').value = '';
  document.getElementById('pwErr').style.display = 'none';
  document.getElementById('pwInput').focus();
}

function checkPw() {
  const pw = document.getElementById('pwInput').value;
  const u = USERS[currentUser];
  const saved = localStorage.getItem(u.pwKey) || u.defaultPw;
  if(pw === saved) {
    document.getElementById('lockScreen').style.display = 'none';
    document.getElementById('app').style.display = 'block';
    initApp();
  } else {
    document.getElementById('pwErr').style.display = 'block';
    document.getElementById('pwInput').value = '';
    document.getElementById('pwInput').focus();
  }
}

function logout() {
  if(fbUnsubscribe) { fbUnsubscribe(); fbUnsubscribe = null; }
  document.getElementById('app').style.display = 'none';
  document.getElementById('lockScreen').style.display = 'flex';
  document.getElementById('pwInput').value = '';
  document.getElementById('pwErr').style.display = 'none';
  document.getElementById('fb-sync-chip').style.display = 'none';
  candidates = [];
  submissions = [];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let candidates = [];
let submissions = [];
let aiMatchCount = 0;

function loadUserData() {
  candidates = JSON.parse(localStorage.getItem(userKey('candidates')) || '[]');
  submissions = JSON.parse(localStorage.getItem(userKey('submissions')) || '[]');
  aiMatchCount = parseInt(localStorage.getItem(userKey('matchcount')) || '0');
}
function saveCandidates() { localStorage.setItem(userKey('candidates'), JSON.stringify(candidates)); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FIREBASE SYNC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let fbUnsubscribe = null;

function setSyncChip(status) {
  const chip = document.getElementById('fb-sync-chip');
  if(!chip) return;
  if(status === 'synced') {
    chip.style.display = 'flex';
    chip.style.background = 'rgba(0,230,118,.1)';
    chip.style.borderColor = 'rgba(0,230,118,.25)';
    chip.style.color = '#00e676';
    chip.textContent = 'âœ… Cloud Synced';
  } else if(status === 'syncing') {
    chip.style.display = 'flex';
    chip.style.background = 'rgba(255,171,64,.1)';
    chip.style.borderColor = 'rgba(255,171,64,.25)';
    chip.style.color = '#ffab40';
    chip.textContent = 'â˜ï¸ Syncing...';
  } else if(status === 'offline') {
    chip.style.display = 'flex';
    chip.style.background = 'rgba(255,82,82,.1)';
    chip.style.borderColor = 'rgba(255,82,82,.25)';
    chip.style.color = '#ff5252';
    chip.textContent = 'âš ï¸ Offline Mode';
  }
}

async function saveSubmissions() {
  localStorage.setItem(userKey('submissions'), JSON.stringify(submissions));
  if(!window._firebaseReady) return;
  try {
    const { db, collection, doc, setDoc } = window._fb;
    setSyncChip('syncing');
    for(const s of submissions) {
      const ref = doc(collection(db, 'submissions_' + currentUser), s.id);
      await setDoc(ref, s);
    }
    setSyncChip('synced');
  } catch(e) {
    console.warn('Firebase sync error:', e);
    setSyncChip('offline');
  }
}

async function loadFirebaseSubmissions() {
  if(!window._firebaseReady) { setSyncChip('offline'); return; }
  try {
    const { db, collection, onSnapshot } = window._fb;
    setSyncChip('syncing');
    if(fbUnsubscribe) fbUnsubscribe();
    fbUnsubscribe = onSnapshot(
      collection(db, 'submissions_' + currentUser),
      (snap) => {
        const fbData = [];
        snap.forEach(d => fbData.push(d.data()));
        fbData.sort((a,b) => {
          const da = new Date(a.date), db2 = new Date(b.date);
          return isNaN(da) || isNaN(db2) ? 0 : db2 - da;
        });
        submissions = fbData;
        localStorage.setItem(userKey('submissions'), JSON.stringify(submissions));
        renderSubmissions();
        updateDashboard();
        setSyncChip('synced');
      },
      (err) => { console.warn('FB listener error:', err); setSyncChip('offline'); }
    );
  } catch(e) {
    console.warn('Firebase load error:', e);
    setSyncChip('offline');
  }
}

async function deleteFirebaseSubmission(id) {
  if(!window._firebaseReady) return;
  try {
    const { db, collection, doc, deleteDoc } = window._fb;
    await deleteDoc(doc(collection(db, 'submissions_' + currentUser), id));
  } catch(e) { console.warn('FB delete error:', e); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initApp() {
  loadUserData();
  const u = USERS[currentUser];
  document.getElementById('user-chip').textContent = u.emoji + ' ' + u.displayName;
  document.getElementById('dash-username').textContent = u.displayName + '!';
  document.getElementById('pw-for-user').textContent = u.displayName;
  renderCandidates();
  renderSubmissions();
  updateDashboard();
  updateSelStatus();
  setTimeout(loadSavedKey, 100);
  switchTab('dashboard');
  // Firebase real-time sync
  if(window._firebaseReady) {
    loadFirebaseSubmissions();
  } else {
    document.addEventListener('firebaseReady', loadFirebaseSubmissions, {once: true});
    setSyncChip('offline');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TAB NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const panels = ['dashboard','candidates','match','tracker','portals','settings'];
function switchTab(t) {
  panels.forEach(p => {
    document.getElementById('panel-'+p).classList.toggle('on', p===t);
    document.getElementById('nav-'+p).classList.toggle('on', p===t);
  });
  if(t==='match') updateSelStatus();
  if(t==='settings') { setTimeout(loadFbConfigInput, 50); }
  if(t==='dashboard') updateDashboard();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FILE UPLOAD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('fileInput').addEventListener('change', e => handleFiles(e.target.files));
const dz = document.getElementById('dropzone');
dz.addEventListener('dragover', e=>{e.preventDefault();dz.classList.add('over')});
dz.addEventListener('dragleave', ()=>dz.classList.remove('over'));
dz.addEventListener('drop', e=>{e.preventDefault();dz.classList.remove('over');handleFiles(e.dataTransfer.files)});

function handleFiles(files) {
  let done = 0; const total = files.length;
  Array.from(files).forEach(file => {
    const ext = file.name.split('.').pop().toLowerCase();
    if(ext==='docx'||ext==='doc') {
      const reader = new FileReader();
      reader.onload = ev => {
        mammoth.extractRawText({arrayBuffer:ev.target.result})
          .then(r => addCandidate(file, r.value||'', ext))
          .catch(() => addCandidate(file, '', ext))
          .finally(() => { if(++done===total){renderCandidates();updateDashboard();showToast('âœ… '+total+' resume(s) uploaded!','#00e676');}});
      };
      reader.readAsArrayBuffer(file);
    } else {
      const reader = new FileReader();
      reader.onload = ev => {
        addCandidate(file, ev.target.result||'', ext);
        if(++done===total){renderCandidates();updateDashboard();showToast('âœ… '+total+' resume(s) uploaded!','#00e676');}
      };
      reader.readAsText(file);
    }
  });
  document.getElementById('fileInput').value='';
}

function addCandidate(file, content, ext) {
  candidates.push({
    id: Date.now()+'_'+Math.random().toString(36).slice(2,7),
    name: file.name.replace(/\.[^.]+$/,''),
    file: file.name,
    size: (file.size/1024).toFixed(1)+' KB',
    date: new Date().toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'}),
    content, skills: extractSkills(content), selected: true, type: ext
  });
  saveCandidates();
}

function extractSkills(text) {
  const known=['java','python','react','angular','vue','node','aws','azure','gcp','sql','javascript','typescript','spring','docker','kubernetes','c#','.net','php','ruby','go','scala','spark','hadoop','tableau','powerbi','salesforce','sap','oracle','mysql','mongodb','redis','terraform','jenkins','git','agile','scrum'];
  const found=[]; const lower=text.toLowerCase();
  known.forEach(s=>{ if(lower.includes(s)&&found.length<6) found.push(s.toUpperCase()); });
  return found;
}

function renderCandidates() {
  document.getElementById('cand-count').textContent = candidates.length;
  const list = document.getElementById('cand-list');
  if(!candidates.length){list.innerHTML='<div class="empty"><div class="empty-icon">ğŸ‘¤</div><div>No candidates yet. Upload resumes above!</div></div>';return;}
  list.innerHTML = candidates.map((c,i) => `
    <div class="cand-item" style="animation-delay:${i*.04}s">
      <div class="cand-check ${c.selected?'on':''}" onclick="toggleCand('${c.id}')">${c.selected?'âœ“':''}</div>
      <div class="cand-avatar">${c.type==='docx'||c.type==='doc'?'ğŸ“':'ğŸ“„'}</div>
      <div class="cand-info">
        <div class="cand-name">${esc(c.name)}</div>
        <div class="cand-meta">${esc(c.file)} Â· ${c.size} Â· ${c.date}</div>
        ${c.skills&&c.skills.length?`<div class="cand-skills">${c.skills.map(s=>`<span class="skill-tag">${esc(s)}</span>`).join('')}</div>`:''}
      </div>
      <button class="cand-del" onclick="delCand('${c.id}')">âœ•</button>
    </div>`).join('');
}

function toggleCand(id){const c=candidates.find(x=>x.id===id);if(c){c.selected=!c.selected;saveCandidates();renderCandidates();updateSelStatus();}}
function selectAllCands(){const all=candidates.every(c=>c.selected);candidates.forEach(c=>c.selected=!all);saveCandidates();renderCandidates();updateSelStatus();}
function delCand(id){candidates=candidates.filter(x=>x.id!==id);saveCandidates();renderCandidates();updateDashboard();showToast('ğŸ—‘ï¸ Removed','#ff5252');}
function clearAll(){if(!confirm('Remove all candidates?'))return;candidates=[];saveCandidates();renderCandidates();updateDashboard();showToast('ğŸ—‘ï¸ Cleared','#ff5252');}

function updateSelStatus(){
  const sel=candidates.filter(c=>c.selected);
  const el=document.getElementById('sel-status');if(!el)return;
  if(!sel.length){el.textContent='âš ï¸ No candidates selected â€” go to Candidates tab first';el.style.color='#ffc107';}
  else{el.textContent=`âœ… ${sel.length} candidate(s) selected and ready`;el.style.color='#00e676';}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TRACKER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addSubmission() {
  const cname = document.getElementById('t-cname').value.trim();
  const skills = document.getElementById('t-skills').value.trim();
  if(!cname||!skills){showToast('âš ï¸ Candidate name & skills required!','#ffc107');return;}
  submissions.unshift({
    id: Date.now()+'_'+Math.random().toString(36).slice(2,5),
    candidateName: cname,
    skills,
    vendor: document.getElementById('t-vendor').value.trim(),
    email: document.getElementById('t-email').value.trim(),
    phone: document.getElementById('t-phone').value.trim(),
    rate: document.getElementById('t-rate').value.trim(),
    location: document.getElementById('t-location').value.trim(),
    status: document.getElementById('t-status').value,
    notes: document.getElementById('t-notes').value.trim(),
    date: new Date().toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'}),
    dateISO: new Date().toISOString().split('T')[0]
  });
  saveSubmissions();
  renderSubmissions();
  updateDashboard();
  // Clear form
  ['t-cname','t-skills','t-vendor','t-email','t-phone','t-rate','t-location','t-notes'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('t-status').value='Submitted';
  showToast('âœ… Submission added!','#00e676');
}

function delSubmission(id){
  submissions=submissions.filter(x=>x.id!==id);
  saveSubmissions();renderSubmissions();updateDashboard();
  deleteFirebaseSubmission(id);
  showToast('ğŸ—‘ï¸ Removed','#ff5252');
}

function updateSubStatus(id, newStatus){
  const s=submissions.find(x=>x.id===id);
  if(s){s.status=newStatus;saveSubmissions();renderSubmissions();updateDashboard();showToast('âœ… Status updated!','#00e676');}
}

function renderSubmissions(){
  const filter = document.getElementById('filter-status')?.value||'';
  const filtered = filter ? submissions.filter(s=>s.status===filter) : submissions;
  document.getElementById('sub-count').textContent = submissions.length;
  const wrap = document.getElementById('sub-table-wrap');
  if(!filtered.length){
    wrap.innerHTML='<div class="empty-table"><div class="ei">ğŸ“­</div><div>No submissions yet. Add one above!</div></div>';
    return;
  }
  const statusClass={Submitted:'s-submitted','Interview Scheduled':'s-interview','Interview Done':'s-interviewing',Placed:'s-placed',Rejected:'s-rejected'};
  wrap.innerHTML=`<table class="sub-table">
    <thead><tr>
      <th>#</th><th>Date</th><th>Candidate</th><th>Skills</th><th>Vendor</th><th>Email</th><th>Phone</th><th>Rate</th><th>Location</th><th>Status</th><th>Notes</th><th>Action</th>
    </tr></thead>
    <tbody>
    ${filtered.map((s,i)=>`<tr>
      <td style="color:var(--muted)">${i+1}</td>
      <td style="color:var(--muted);white-space:nowrap">${s.date}</td>
      <td style="font-weight:600;white-space:nowrap">${esc(s.candidateName)}</td>
      <td style="color:var(--accent)">${esc(s.skills)}</td>
      <td>${esc(s.vendor||'â€”')}</td>
      <td><a href="mailto:${esc(s.email)}" style="color:var(--accent);text-decoration:none">${esc(s.email||'â€”')}</a></td>
      <td style="white-space:nowrap">${esc(s.phone||'â€”')}</td>
      <td style="color:var(--green);white-space:nowrap">${esc(s.rate||'â€”')}</td>
      <td style="white-space:nowrap">${esc(s.location||'â€”')}</td>
      <td>
        <select class="tf-select" style="width:auto;padding:4px 8px;font-size:11px" onchange="updateSubStatus('${s.id}',this.value)">
          ${['Submitted','Interview Scheduled','Interview Done','Placed','Rejected'].map(st=>`<option value="${st}" ${s.status===st?'selected':''}>${st}</option>`).join('')}
        </select>
      </td>
      <td style="max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:var(--muted)">${esc(s.notes||'â€”')}</td>
      <td><button class="del-row-btn" onclick="delSubmission('${s.id}')">ğŸ—‘ï¸</button></td>
    </tr>`).join('')}
    </tbody>
  </table>`;
}

function exportExcel() {
  if(!submissions.length){showToast('âš ï¸ No submissions to export!','#ffc107');return;}
  const u = USERS[currentUser];
  const headers = ['#','Date','Candidate Name','Skills','Vendor','Email','Phone','Rate','Location','Status','Notes'];
  const rows = submissions.map((s,i) => [i+1,s.date,s.candidateName,s.skills,s.vendor||'',s.email||'',s.phone||'',s.rate||'',s.location||'',s.status,s.notes||'']);
  let csv = headers.join(',') + '\n';
  rows.forEach(r => { csv += r.map(v => `"${String(v).replace(/"/g,'""')}"`).join(',') + '\n'; });
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `BenchMatch_${u.displayName}_Submissions_${new Date().toISOString().split('T')[0]}.csv`;
  a.click();
  showToast('ğŸ“¥ Excel file downloaded!','#00e676');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateDashboard(){
  document.getElementById('stat-candidates').textContent = candidates.length;
  document.getElementById('stat-submissions').textContent = submissions.length;
  document.getElementById('stat-interviews').textContent = submissions.filter(s=>s.status==='Interview Scheduled'||s.status==='Interview Done').length;
  document.getElementById('stat-placed').textContent = submissions.filter(s=>s.status==='Placed').length;
  document.getElementById('stat-matches').textContent = parseInt(localStorage.getItem(userKey('matchcount'))||'0');

  const recent = submissions.slice(0,5);
  const el = document.getElementById('dash-recent-subs');
  if(!recent.length){el.innerHTML='<div class="empty"><div class="empty-icon">ğŸ“­</div><div>No submissions yet â€” use Tracker tab to add!</div></div>';return;}
  const statusClass={Submitted:'s-submitted','Interview Scheduled':'s-interview','Interview Done':'s-interviewing',Placed:'s-placed',Rejected:'s-rejected'};
  el.innerHTML = `<div class="recent-sub-list">${recent.map(s=>`
    <div class="recent-sub-item">
      <div style="font-size:22px">${s.status==='Placed'?'ğŸ†':s.status==='Rejected'?'âŒ':s.status.includes('Interview')?'ğŸ“…':'ğŸ“¤'}</div>
      <div class="rsub-info">
        <div class="rsub-name">${esc(s.candidateName)}</div>
        <div class="rsub-meta">${esc(s.skills)} Â· ${esc(s.vendor||'No vendor')} Â· ${s.date}</div>
      </div>
      <span class="status-badge ${statusClass[s.status]||'s-submitted'}">${s.status}</span>
    </div>`).join('')}
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  JOB PORTALS SEARCH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function searchAllPortals(){
  const kw = document.getElementById('portal-kw').value.trim();
  if(!kw){showToast('âš ï¸ Enter a keyword first!','#ffc107');return;}
  const enc = encodeURIComponent(kw+' C2C contract');
  const links = [
    {name:'ğŸ² Dice',url:`https://www.dice.com/jobs?q=${enc}&filters.employerType=Third+Party`},
    {name:'ğŸ’» TechFetch',url:`https://www.techfetch.com/job/searchjobs.aspx?q=${enc}`},
    {name:'ğŸ—ï¸ CareerBuilder',url:`https://www.careerbuilder.com/jobs?keywords=${enc}`},
    {name:'ğŸ” Indeed',url:`https://www.indeed.com/jobs?q=${enc}`},
    {name:'ğŸ‘¾ Monster',url:`https://www.monster.com/jobs/search?q=${enc}`},
    {name:'ğŸ“¦ ZipRecruiter',url:`https://www.ziprecruiter.com/jobs-search?search=${enc}`},
    {name:'ğŸ¤ Corp2Corp',url:`https://www.corp2corp.jobs/search?q=${enc}`},
    {name:'â˜• ITJobCafe',url:`https://www.itjobcafe.com/search?q=${enc}`},
  ];
  document.getElementById('portal-links').style.display='block';
  document.getElementById('portal-qlinks').innerHTML = links.map(l=>`<a href="${l.url}" target="_blank" class="qlink">${l.name}</a>`).join('');
  showToast('âœ… Links ready â€” click to open!','#00e676');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RUN MATCH (AI)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function runMatch(){
  const jd = document.getElementById('jdInput').value.trim();
  const sel = candidates.filter(c=>c.selected);
  if(!jd){showToast('âš ï¸ Paste a requirement first!','#ffc107');return;}
  if(!sel.length){showToast('âš ï¸ Select candidates first!','#ffc107');switchTab('candidates');return;}
  const btn = document.getElementById('analyzeBtn');
  btn.disabled=true;btn.textContent='â³ AI is analyzing...';
  document.getElementById('results-area').innerHTML=`<div class="loader-wrap"><div class="loader"></div><div class="loader-text" style="font-size:15px;font-weight:600;color:var(--text)">AI reviewing ${sel.length} candidate(s)...</div><div class="loader-text" style="margin-top:6px">Reading resumes like a 15-year experienced bench sales recruiter ğŸ¤µ</div></div>`;
  try {
    const results = await Promise.all(sel.map(c=>analyzeCandidate(c,jd)));
    results.sort((a,b)=>b.score-a.score);
    const mc = parseInt(localStorage.getItem(userKey('matchcount'))||'0') + results.length;
    localStorage.setItem(userKey('matchcount'), mc);
    renderResults(results, jd);
  } catch(e) {
    document.getElementById('results-area').innerHTML=`<div class="card" style="color:var(--red);text-align:center">âŒ Error: ${esc(e.message)}<br><small style="color:var(--muted)">Check API key in Settings or try again.</small></div>`;
  }
  btn.disabled=false;btn.innerHTML='ğŸ¤– Match with AI Hiring Manager';
}

async function analyzeCandidate(candidate, jd){
  const prompt=`You are TWO things: (1) An ATS system that does precise keyword matching, AND (2) An experienced Bench Sales Recruiter with 15 years in US IT Staffing.

JOB REQUIREMENT:
${jd.slice(0,2500)}

CANDIDATE: ${candidate.name}
RESUME:
${candidate.content.slice(0,3000)||'[Analyze based on detected skills: '+(candidate.skills||[]).join(', ')+']'}

Respond ONLY with valid JSON (no markdown):
{
  "score": <0-100>,
  "verdict": "<Strong Match|Good Match|Partial Match|Weak Match>",
  "shortlist": <true|false>,
  "submit_priority": "<Hot Submit|Submit|Maybe|Skip>",
  "one_liner": "<one honest recruiter line>",
  "matched_keywords": ["up to 8"],
  "missing_keywords": ["up to 6"],
  "recruiter_note": "<2-3 sentences practical recruiter note>",
  "ats_tips": [{"title":"tip","detail":"detail"},{"title":"tip","detail":"detail"},{"title":"tip","detail":"detail"}],
  "email_subject": "<subject line>",
  "email_body": "<4-5 line vendor submission email. Use [CANDIDATE NAME], [RATE], [VISA] as placeholders.>"
}`;
  const apiKey = localStorage.getItem('bmp_gemini_key')||'';
  if(!apiKey) throw new Error('Gemini API Key nahi hai! Settings tab mein jaao.');
  const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`,{
    method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({contents:[{parts:[{text:prompt}]}],generationConfig:{temperature:0.3,maxOutputTokens:1200}})
  });
  if(!res.ok){const err=await res.json();throw new Error(err.error?.message||'API error '+res.status);}
  const data=await res.json();
  const raw=data.candidates?.[0]?.content?.parts?.[0]?.text||'';
  const json=JSON.parse(raw.replace(/```json|```/g,'').trim());
  json.candidateName=candidate.name;
  return json;
}

function renderResults(list,jd){
  const hot=list.filter(r=>r.score>=80).length;
  const shortlisted=list.filter(r=>r.shortlist).length;
  const jdKw=encodeURIComponent(jd.split('\n')[0].slice(0,60));
  document.getElementById('results-area').innerHTML=`
    <div class="result-summary">
      <div><div class="rs-title">âœ… Match Results â€” ${list.length} Candidate(s)</div><div style="font-size:12px;color:var(--muted);margin-top:4px">Ranked by AI match score Â· Click to expand</div></div>
      <div class="rs-stats">
        <div class="rs-stat"><div class="rs-num" style="color:var(--green)">${hot}</div><div class="rs-label">Hot Matches</div></div>
        <div class="rs-stat"><div class="rs-num" style="color:var(--gold)">${shortlisted}</div><div class="rs-label">Shortlisted</div></div>
        <div class="rs-stat"><div class="rs-num" style="color:var(--accent)">${list.length}</div><div class="rs-label">Analyzed</div></div>
      </div>
    </div>
    <div style="margin-bottom:14px">
      <div style="font-size:12px;color:var(--muted);margin-bottom:8px;font-weight:600">ğŸ”— Search this requirement on C2C portals:</div>
      <div class="qlinks">
        <a href="https://www.dice.com/jobs?q=${jdKw}&filters.employerType=Third+Party" target="_blank" class="qlink">ğŸ² Dice</a>
        <a href="https://www.techfetch.com/job/searchjobs.aspx?q=${jdKw}" target="_blank" class="qlink">ğŸ’» TechFetch</a>
        <a href="https://www.corp2corp.jobs/search?q=${jdKw}" target="_blank" class="qlink">ğŸ¤ Corp2Corp</a>
        <a href="https://www.careerbuilder.com/jobs?keywords=${jdKw}" target="_blank" class="qlink">ğŸ—ï¸ CareerBuilder</a>
        <a href="https://www.itjobcafe.com/search?q=${jdKw}" target="_blank" class="qlink">â˜• ITJobCafe</a>
        <a href="https://www.indeed.com/jobs?q=${jdKw}" target="_blank" class="qlink">ğŸ” Indeed</a>
      </div>
    </div>
    <div class="result-list" id="result-list">${list.map((r,i)=>resultItemHtml(r,i)).join('')}</div>
    <div style="height:40px"></div>`;
  setTimeout(()=>{ list.forEach((r,i)=>{ const b=document.getElementById('rbar_'+i); if(b){b.style.width=r.score+'%';b.style.background=scoreColor(r.score);} }); },150);
}

function resultItemHtml(r,i){
  const pc=r.score>=80?'sp-hot':r.score>=60?'sp-good':r.score>=40?'sp-avg':'sp-low';
  return `<div class="result-item" style="animation-delay:${i*.07}s">
    <div class="result-header" onclick="toggleResult(${i})">
      <div class="score-pill ${pc}">${r.score}%</div>
      <div class="result-info">
        <div class="result-name">ğŸ‘¤ ${esc(r.candidateName)} ${r.shortlist?'<span class="shortlist-star">â­</span>':''} ${r.submit_priority==='Hot Submit'?'<span style="background:rgba(0,230,118,.12);color:#00e676;font-size:11px;font-weight:700;padding:2px 8px;border-radius:6px;margin-left:6px">ğŸ”¥ HOT</span>':''}</div>
        <div class="result-verdict">${esc(r.one_liner||r.verdict)}</div>
      </div>
      <div class="result-bar-wrap"><div class="result-bar-bg"><div class="result-bar-fill" id="rbar_${i}" style="width:0%"></div></div><div class="result-verdict-label">${r.verdict} Â· ${r.submit_priority||''}</div></div>
      <div style="color:var(--muted);font-size:18px;transition:transform .3s" id="arrow_${i}">â€º</div>
    </div>
    <div class="result-body" id="rbody_${i}">
      <div class="kw-grid">
        <div class="kw-box"><div class="kw-title">âœ… Matched</div><div class="kw-tags">${(r.matched_keywords||[]).map(k=>`<span class="kw-match">${esc(k)}</span>`).join('')||'<span style="color:var(--muted);font-size:12px">None</span>'}</div></div>
        <div class="kw-box"><div class="kw-title">âŒ Missing</div><div class="kw-tags">${(r.missing_keywords||[]).map(k=>`<span class="kw-miss">${esc(k)}</span>`).join('')||'<span style="color:var(--green);font-size:12px">All covered!</span>'}</div></div>
      </div>
      <div class="ai-note">
        <div class="ai-note-header"><div class="ai-face">ğŸ¤µ</div><div><div class="ai-note-name">Alex â€” Senior Bench Sales Recruiter</div><div class="ai-note-role">15 years US Staffing</div></div></div>
        <div class="ai-note-text">"${esc(r.recruiter_note||'No notes.')}"</div>
      </div>
      ${r.ats_tips&&r.ats_tips.length?`<div style="font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px">ğŸ› ï¸ Resume Tips</div><div class="tips-list">${r.ats_tips.map((t,j)=>`<div class="tip-item"><div class="tip-num">${j+1}</div><div class="tip-text"><strong>${esc(t.title)}</strong><span>${esc(t.detail)}</span></div></div>`).join('')}</div>`:''}
      ${r.email_subject&&r.email_body?`<div class="email-box"><div class="email-box-title"><span>ğŸ“§ Vendor Submission Email</span><button class="copy-btn" onclick="copyEmail(${i})">ğŸ“‹ Copy</button></div><div style="margin-bottom:8px"><span style="font-size:11px;color:var(--muted);font-weight:600">SUBJECT: </span><span style="font-size:13px" id="esubj_${i}">${esc(r.email_subject)}</span></div><div class="email-content" id="ebody_${i}">${esc(r.email_body)}</div></div>`:''}
    </div>
  </div>`;
}

function toggleResult(i){const b=document.getElementById('rbody_'+i);const a=document.getElementById('arrow_'+i);const open=b.style.display!=='none'&&b.style.display!=='';b.style.display=open?'none':'block';if(a)a.style.transform=open?'rotate(0deg)':'rotate(90deg)';}
function copyEmail(i){const s=document.getElementById('esubj_'+i);const b=document.getElementById('ebody_'+i);if(!s||!b)return;navigator.clipboard.writeText('Subject: '+s.textContent+'\n\n'+b.textContent).then(()=>showToast('ğŸ“‹ Copied!','#00e676'));}
function scoreColor(s){if(s>=80)return'#00e676';if(s>=60)return'#00b4d8';if(s>=40)return'#ffab40';return'#ff5252';}

function setPTab(i){document.querySelectorAll('.ptab').forEach((el,j)=>el.classList.toggle('on',i===j));document.getElementById('jdInput').placeholder=i===0?'Paste Gmail requirement here...\n\nExample:\nHi, urgent req for Java Developer\nLocation: Austin TX\nDuration: 12 months C2C\nRate: $65/hr\nSkills: Java, Spring Boot, AWS\nVisa: Any':'Paste job board requirement here...';}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveApiKey(){const key=document.getElementById('apiKeyInput').value.trim();if(!key)return showToast('âš ï¸ Enter key first!','#ffc107');if(!key.startsWith('AIza'))return showToast('âš ï¸ Key format wrong!','#ff5252');localStorage.setItem('bmp_gemini_key',key);document.getElementById('apiKeyStatus').innerHTML='âœ… <span style="color:#00e676">Key saved!</span>';showToast('âœ… API Key saved!','#00e676');}
async function testApiKey(){const key=localStorage.getItem('bmp_gemini_key')||document.getElementById('apiKeyInput').value.trim();if(!key)return showToast('âš ï¸ Save key first!','#ffc107');const el=document.getElementById('apiKeyStatus');el.innerHTML='â³ Testing...';try{const res=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{parts:[{text:'Say OK'}]}],generationConfig:{maxOutputTokens:5}})});const data=await res.json();if(res.ok){el.innerHTML='âœ… <span style="color:#00e676">Key working! ğŸ‰</span>';showToast('âœ… Key working!','#00e676');}else{el.innerHTML=`âŒ <span style="color:#ff5252">${data.error?.message||'Error'}</span>`;}}catch(e){el.innerHTML=`âŒ <span style="color:#ff5252">Connection error</span>`;}}
function toggleApiVis(){const i=document.getElementById('apiKeyInput');const b=document.getElementById('apiVisBtn');i.type=i.type==='password'?'text':'password';b.textContent=i.type==='password'?'Show':'Hide';}
function loadSavedKey(){const key=localStorage.getItem('bmp_gemini_key');if(key&&document.getElementById('apiKeyInput')){document.getElementById('apiKeyInput').value=key;document.getElementById('apiKeyStatus').innerHTML='âœ… <span style="color:#00e676">Key saved â€” ready!</span>';}}
function changePw(){const p1=document.getElementById('newPw1').value;const p2=document.getElementById('newPw2').value;if(!p1)return showToast('Enter new password','#ff5252');if(p1!==p2)return showToast('Passwords do not match!','#ff5252');const u=USERS[currentUser];localStorage.setItem(u.pwKey,p1);document.getElementById('newPw1').value='';document.getElementById('newPw2').value='';showToast('âœ… Password changed!','#00e676');}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Firebase Config Management
function saveFbConfig() {
  const raw = document.getElementById('fb-config-input').value.trim();
  if(!raw) { showToast('âš ï¸ Config paste karo pehle!','#ffc107'); return; }
  try {
    // Extract JSON from firebaseConfig = { ... } or just { ... }
    const jsonStr = raw.replace(/^[^{]*/, '').replace(/[^}]*$/, '');
    // Convert JS object (no quotes on keys) to JSON
    const cleaned = jsonStr
      .replace(/\/\/.*/g,'')
      .replace(/([{,])\s*([a-zA-Z_]\w*)\s*:/g, '$1"$2":')
      .replace(/'/g,'"');
    const cfg = JSON.parse(cleaned);
    localStorage.setItem('bmp_firebase_config', JSON.stringify(cfg));
    document.getElementById('fb-config-status').innerHTML = 'âœ… <span style="color:#00e676">Config saved! Page reload karo to activate.</span>';
    showToast('âœ… Firebase config saved! Reload karo.','#00e676');
  } catch(e) {
    document.getElementById('fb-config-status').innerHTML = 'âŒ <span style="color:#ff5252">Format error. Correct config paste karo.</span>';
    showToast('âŒ Config format galat hai!','#ff5252');
  }
}

function testFbConfig() {
  const cfg = localStorage.getItem('bmp_firebase_config');
  if(!cfg) { showToast('âš ï¸ Pehle config save karo!','#ffc107'); return; }
  if(window._firebaseReady) {
    document.getElementById('fb-config-status').innerHTML = 'âœ… <span style="color:#00e676">Firebase connected & working! ğŸ‰</span>';
    showToast('âœ… Firebase working!','#00e676');
  } else {
    document.getElementById('fb-config-status').innerHTML = 'âš ï¸ <span style="color:#ffab40">Config saved, page reload karo to test.</span>';
    showToast('âš ï¸ Page reload karo','#ffab40');
  }
}

function loadFbConfigInput() {
  const cfg = localStorage.getItem('bmp_firebase_config');
  const el = document.getElementById('fb-config-input');
  if(cfg && el) el.value = JSON.stringify(JSON.parse(cfg), null, 2);
}

function showToast(msg,color='#00b4d8'){const t=document.createElement('div');t.className='toast';t.textContent=msg;t.style.borderColor=color+'44';t.style.color=color;document.body.appendChild(t);setTimeout(()=>{t.style.opacity='0';t.style.transition='opacity .4s';setTimeout(()=>t.remove(),400);},3000);}
function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
</script>
</body>
</html>
